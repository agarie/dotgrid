<html>
<head>
<style>
body {
    font-family: system-ui, -apple-system, sans-serif;
    background: #f5f5f5;
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    padding: 2rem;
}

form {
    background: white;
    padding: 2rem;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    width: 100%;
    max-width: 480px;
}

fieldset {
    border: 1px solid #e0e0e0;
    border-radius: 4px;
    margin-bottom: 1.25rem;
    padding: 1rem;
}

legend {
    font-weight: 600;
    padding: 0 0.5rem;
    color: #333;
}

label {
    display: inline-block;
    margin-right: 0.5rem;
    min-width: 70px;
}

input[type="text"],
input[type="number"],
select {
    padding: 0.375rem 0.5rem;
    border: 1px solid #ccc;
    border-radius: 4px;
}

input[type="checkbox"] {
    margin-right: 0.5rem;
}

#download {
    display: inline-block;
    background: #0066cc;
    color: white;
    padding: 0.75rem 1.5rem;
    border-radius: 4px;
    text-decoration: none;
    margin-right: 0.5rem;
}

#download:hover {
    background: #0052a3;
}
</style>
</head>
<body>
<form id="dotgrid-form">
    <fieldset>
        <legend>Paper & Units</legend>
        <label for="paper">Output:</label>
        <select id="paper">
            <option value="a4" selected>A4</option>
            <option value="a5">A5</option>
            <option value="letter">US Letter</option>
            <option value="halfletter">Half Letter</option>
        </select> <br>
        <label for="units">Units:</label>
        <select id="units">
            <option value="72">inches</option>
            <option value="2.83465" selected>mm</option>
        </select> <br>
        <label for="twosided">Mirrored second page</label>
        <input id="twosided" type="checkbox"/>
    </fieldset>

    <fieldset>
        <legend>Margin</legend>
        <label for="marginL">left:</label>
        <input id="marginL" type="text" value="16"/> <br>
        <label for="marginT">top:</label>
        <input id="marginT" type="text" value="20"/> <br>
        <label for="marginR">right:</label>
        <input id="marginR" type="text" value="8"/> <br>
        <label for="marginB">bottom:</label>
        <input id="marginB" type="text" value="8"/>
    </fieldset>

    <fieldset>
        <legend>Dot Settings</legend>
        <label for="dsize">size:</label>
        <input id="dsize" type="text" value="0.20"/> <br>
        <label for="dspace">spacing:</label>
        <input id="dspace" type="text" value="6"/> <br>
        <label for="dgray">opacity:</label>
        <input id="dgray" type="number" min="0.1" max="1.0" step="0.1" value="0.2"/>
    </fieldset>

    <fieldset>
        <legend>Vertical Line</legend>
        <label for="linecol">Position (%):</label>
        <input id="linecol" type="number" min="0" max="100" value="0"/> <br>
        <label for="pagenum">Include page number</label>
        <input id="pagenum" type="checkbox"/>
    </fieldset>

    <fieldset>
        <a id="download" download="dotgrid.pdf">Download PDF</a>
        <a href="https://agarie.net.br/2026/02/dotgrid-paper-generator-in-a-single-html-file.html">About</a>
    </fieldset>
</form>

<script>
function pdf(mleft, mright, mtop, mbot, width, height, gray, radius, spacing, linecol, pagenum) {
  t = `%PDF-1.2
 1 0 obj
 <<
 /Pages 2 0 R
 /Type /Catalog
 >>
 endobj
 2 0 obj
 <<
 /Type /Pages
 /MediaBox [ 0 0 ${width} ${height} ]
 /Kids [3 0 R]
 /Count 1
 >>
 endobj
 3 0 obj
 <<
 /Type /Page
 /Parent 2 0 R
 /Contents 4 0 R
 >>
 endobj
 4 0 obj << >>
 `
  hspace = width - mleft - mright
  hoffset = mleft + (hspace % spacing / 2)
  hdots = Math.trunc(hspace / spacing) + 1
  vspace = height - mtop - mbot
  voffset = mbot + (vspace % spacing / 2)
  vdots = Math.trunc(vspace / spacing) + 1

  pagenum_line = pagenumLine(pagenum, width, height, mtop, spacing, radius)

  t += dotStream(gray, radius, spacing, hoffset, voffset, hdots, vdots, width, height, linecol, pagenum_line)
  t += `endobj
   trailer
 <</Root 1 0 R>>
 %%EOF
  `
  return t
}

function twoSidedPdf(mleft, mright, mtop, mbot, width, height, gray, radius, spacing, linecol, pagenum) {
  t = `%PDF-1.2
 1 0 obj
 <<
 /Pages 2 0 R
 /Type /Catalog
 >>
 endobj
 2 0 obj
 <<
 /Type /Pages
 /MediaBox [ 0 0 ${width} ${height} ]
 /Kids [3 0 R 5 0 R]
 /Count 2
 >>
 endobj
 3 0 obj
 <<
 /Type /Page
 /Parent 2 0 R
 /Contents 4 0 R
 >>
 endobj
 4 0 obj << >>
 `
  hspace = width - mleft - mright
  hoffset = mleft + (hspace % spacing / 2)
  hdots = Math.trunc(hspace / spacing) + 1
  vspace = height - mtop - mbot
  voffset = mbot + (vspace % spacing / 2)
  vdots = Math.trunc(vspace / spacing) + 1

  pagenum_line = pagenumLine(pagenum, width, height, mtop, spacing, radius)

  t += dotStream(gray, radius, spacing, hoffset, voffset, hdots, vdots, width, height, linecol, pagenum_line)
  t += `endobj
  5 0 obj
 <<
 /Type /Page
 /Parent 2 0 R
 /Contents 6 0 R
 >>
 endobj
 6 0 obj << >>
  `
  hoffset = mright + (hspace % spacing / 2)
  t += dotStream(gray, radius, spacing, hoffset, voffset, hdots, vdots, width, height, linecol, pagenum_line)
  t += `endobj
   trailer
 <</Root 1 0 R>>
 %%EOF
  `
  return t
}

function dotStream(gray, radius, spacing, hoffset, voffset, hdots, vdots, width, height, linecol, pagenum_line) {
  t = `stream
 q
 ${gray} g
 `
  unitcircle = `1 0 m
 1 0.55228475 0.55228475 1 0 1 c
 -0.55228475 1 -1 0.55228475 -1 0 c
 -1 -0.55228475 -0.55228475 -1 0 -1 c
 0.55228475 -1 1 -0.55228475 1 0 c
 f
 `
  rStr = radius.toString()
  for (let x = 0; x < hdots; ++x) {
    for (let y = 0; y < vdots; ++y) {
      t += "q\n"
      t += rStr + " 0 0 " + rStr + " "
      t += (hoffset + spacing * x).toString() + " "
      t += (voffset + spacing * y).toString() + " cm\n"
      t += unitcircle
      t += "Q\n"
    }
  }
  if (pagenum_line) {
    t += pagenum_line
  }
  if (linecol > 0 && linecol < 100) {
    colIndex = Math.trunc(hdots * (1 - linecol / 100)) - 1
    lineX = hoffset + spacing * colIndex - radius
    lineY = voffset
    lineWidth = radius * 2
    lineHeight = spacing * (vdots - 1)
    t += "0 g\n"
    t += lineX + " " + lineY + " " + lineWidth + " " + lineHeight + " re f\n"
  }
  t += `Q
  endstream
  `
  return t
}

function pagenumLine(pagenum, width, height, mtop, spacing, radius) {
  lineWidth = 33
  lineHeight = radius * 2
  lineX = width - lineWidth - spacing
  lineY = height - mtop + (spacing / 2)

  if (pagenum) {
    return "0 g\n" + lineX + " " + lineY + " " + lineWidth + " " + lineHeight + " re f\n"
  } else {
    return false
  }
}

function updateValue() {
  scale = parseFloat(document.getElementById("units").value)
  ml = parseFloat(document.getElementById("marginL").value) * scale
  mr = parseFloat(document.getElementById("marginR").value) * scale
  mt = parseFloat(document.getElementById("marginT").value) * scale
  mb = parseFloat(document.getElementById("marginB").value) * scale
  dgray = parseFloat(document.getElementById("dgray").value)
  dsize = parseFloat(document.getElementById("dsize").value) * scale
  dspace = parseFloat(document.getElementById("dspace").value) * scale
  switch (document.getElementById("paper").value) {
  case "a4":
    width = 595.28
    height = 841.89
    break;
  case "a5":
    width = 420.94
    height = 595.28
    break;
  case "letter":
    width = 612
    height = 792
    break;
  case "halfletter":
    width = 396
    height = 612
    break;
  }
  twosided = document.getElementById("twosided").checked
  linecol = Math.min(100, Math.max(0, parseFloat(document.getElementById("linecol").value) || 0))
  pagenum = document.getElementById("pagenum").checked
  if (twosided) {
    t = twoSidedPdf(ml, mr, mt, mb,
            width, height,
            dgray, dsize, dspace, linecol, pagenum)
  } else {
    t = pdf(ml, mr, mt, mb,
            width, height,
            dgray, dsize, dspace, linecol, pagenum)
  }
  document.getElementById("download").setAttribute("href",
    "data:text/plain;charset=utf-8," + encodeURIComponent(t))
}

let inputs = ["paper", "units",
              "marginL", "marginR", "marginT", "marginB",
              "dsize", "dspace", "dgray",
              "twosided", "linecol", "pagenum"]
for (let i = 0; i < inputs.length; ++i) {
  const input = document.getElementById(inputs[i]);
  input.addEventListener("change", updateValue);
}

updateValue()
</script>
</body>
</html>
